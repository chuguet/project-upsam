<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Exploraci&oacute;n f&iacute;sica - Laboratorio de An&acute;lisis de Movimientos</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="format-detection" content="telephone=no" />
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />

		<link rel="stylesheet" href="../css/themes/hospital_css.min.css" />
		<link rel="stylesheet" href="../css/themes/jquery.mobile.icons.min.css" />
		<link rel="stylesheet" href="../css/jquery.mobile.structure-1.4.2.min.css" />
		
		<script type="text/javascript" src="../cordova.js"></script>
		<script type="text/javascript" src="../index.js"></script>		
		<script type="text/javascript" src="../js/ctrl.generic.js"></script>
		<script type="text/javascript" src="../js/server.js"></script>	
		<script type="text/javascript" src='../js/jquery-1.9.1.min.js'></script>
		<script type="text/javascript" src='../js/jquery.mobile-1.4.1.min.js'></script>
	
		<script type="text/javascript">
			generic.initialize();
			
			function captureSuccess(mediaFiles) {
		    	for (var i = 0; i < mediaFiles.length; i++) {
		            uploadFile(mediaFiles[i]);
		        }
		    }
		
		    // Called if something bad happens.
		    function captureVideoError() {
		    	generic.alert("Grabacion fallida", "Se ha producido un error durante la grabacion de video");
		    }
		
		    // A button will call this function
		    //
		    function captureVideo() {
		        navigator.device.capture.captureVideo(captureSuccess, captureVideoError, {limit: 2});
		    }
		
			function uploadFileSuccess(result){
	            console.log('Upload success: ' + result.responseCode);
	            console.log(result.bytesSent + ' bytes sent');
	            generic.alert("Grabacion correcta", "El video se ha grabado y se ha subido correctamente al servidor");
	        }
	        
	        function uploadFileError(error){
	        	generic.alert("Grabacion fallida", "Se ha producido un error durante la subida del vï¿½deo al servidor");
	        	console.log("An error has occurred: Code = " + error.code);
	            console.log("upload error source " + error.source);
	            console.log("upload error target " + error.target);
	            console.log('Error uploading file ' + path + ': ' + error.code);
	        }
	        
		    // Upload files to server
		    function uploadFile(mediaFile) {
		        var ft = new FileTransfer();
		        var path = mediaFile.fullPath;
		        var name = mediaFile.name;
		        var options = new FileUploadOptions();
		        options.fileKey = "file";
		        options.fileName = mediaFile.name;
		        options.mimeType = "multipart/form-data";
		        options.chunkedMode = false;
		        options.headers = { Connection: "close" };
		        
		        ft.upload(path,
		            encodeURI(server.URI + "pacientemovil/1/videoupload"),
		            uploadFileSuccess,
		            uploadFileError,
		            options);
		    }
		</script>
	</head>
	<body>

		<div data-role="page">
			<!-- Cabecera -->
			<div data-role="header">                    
				<h3>Nuevo v&iacute;deo - LAM</h3>
				<a data-rel="back" data-icon="back">Volver</a>
			</div>			
			
			<!-- Contenido -->
			<div data-role="content">			
				<h2>Nuevo v&iacute;deo</h2>
				
				<div class="content2">
					<!--Descripcion del video -->			
					<div data-role="fieldcontain">  
						<label for="descVideo">Descripci&oacute;n del video:</label>						
						<input type="text" name="descVideo" class="txt-speech" id="descVideo" />				
					</div>

					<!--Grabacion -->
					<div data-role="fieldcontain">					
						<a data-role="button" data-icon="video" data-iconpos="top" onclick="captureVideo();">Grabar video</a>
					</div>
				</div>				
			</div>
			
			<!-- Pie -->
			<div data-role="footer" data-position="inline" data-theme="c">
				<center><img src="../img/tituloLAMPie.png"/><br><img src="../img/tituloLAMPie2.png"/></center>
			</div>
		</div>
	</body>
</html>