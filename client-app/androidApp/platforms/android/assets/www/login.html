<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <title>Login</title>
        
        <link href="css/jquery.mobile-1.4.1.min.css" rel="stylesheet" type="text/css">
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="index.js"></script>
        <script type="text/javascript" src='js/jquery-1.9.1.min.js'></script>
        <script type="text/javascript" src='js/jquery.mobile-1.4.1.min.js'></script>
        <script type="text/javascript">
            app.initialize();

            function login() {
				$.ajax({
					type : 'POST',
					url : "http://192.168.1.134:8080/hospitalServer/j_spring_security_check",
					data : {'j_username': $("#txtUsuario").val(), 'j_password': $("#txtPwd").val()},
					dataType : 'json',
					beforeSend: function (request) {
						$.mobile.loading( 'show', {
  						text: 'Procesando',
  						textVisible: true,
  						theme: "b",
  						textonly: false
  						});
		                request.setRequestHeader("X-Ajax-call", true);
		            },
		            complete : function(jqXHR, textStatus) {
		            	$.mobile.loading('hide');
            			if (jqXHR.statusText == "No Autorizado") {
                  			toast("Usuario y/o contrase&ntilde;a incorrectos");
            			}
            			else if (jqXHR.statusText == "OK") {
                  			$.mobile.changePage('home.html','#loginpage', { transition: "slide"} ); 
            			}
            			else{
            				toast("Se ha producido un error en servidor");
            			}
	            	}
				});
			}
			
			
				var toast=function(msg){
					$("<div class='ui-loader ui-overlay-shadow ui-body-e ui-corner-all'><h3>"+msg+"</h3></div>")
					.css({ display: "block", 
						opacity: 0.90, 
						position: "fixed",
						padding: "7px",
						"text-align": "center",
						width: "270px",
						left: ($(window).width() - 284)/2,
						top: $(window).height()/2 })
					.appendTo( $.mobile.pageContainer ).delay( 1500 )
					.fadeOut( 600, function(){
						$(this).remove();
					});
				}
        </script>
        <style>
        	.ui-mobile form.login{position: absolute; width: 350px; height: 285px; top:50%; left:50%; margin-left:-175px; margin-top:-142px;}
        	.ui-mobile form.login h1 {text-align:center;}
        	.ui-mobile .ui-page-theme-a .login .ui-btn{width:46%;}
        </style>
    </head>
    <body>
    	<div data-role="page" id="loginpage">
			<div data-role="header"><h1>Acceso de usuarios</h1></div>
			<div role="main" class="ui-content">
	            <div id="login" class="ui-field-contain login">
					<span>Usuario:</span> <input type="text" id="txtUsuario" />
					<span>Contrase&ntilde;a:</span><input type="password" id="txtPwd" />
					<button id="btnAceptar" class="ui-btn ui-btn-inline ui-icon-check ui-btn-icon-left" onclick="javascript:login();">Aceptar</button>
					<button id="btnCancelar" class="ui-btn ui-btn-inline ui-icon-delete ui-btn-icon-left" onclick="$("#login").reset();">Cancelar</button>
				</div>
            </div>
       	</div>
    </body>
</html>
